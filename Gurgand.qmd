---
title: "Gurgand"
author: "Leon Gurgand"
format: html
editor: visual
---

link to the GitHub : https://github.com/LeonG000/grades-eval \## 1.1) Study organisation

### Q1)

```{r}
library(here)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(knitr)
library(readr)
here::i_am("grades-eval.Rproj")
```

```{r}
#|eval: false
courses <- read.csv(here("subject-8","courses.csv"))
```

### Q2)

```{r}
courses_renamed <- courses |>
  rename(
    course = course,
    identifier = course_id,
    module = module,
    number_of_exams = nb_grades
  ) |>
  arrange(course)

kable(courses_renamed)
```

## 1.2) Students

### Q3)

```{r}
students <- read.csv(here("subject-8","students.csv"))
```

```{r}
students <- students |>
  mutate(
    birth_date = as.Date(birth_date), 
    sex = as.factor(sex)
  )
```

```{r}
class(students$birth_date)
class(students$sex)
```

## 1.3) Grades

### Q4)

```{r}
grades_clean <- read_delim(here("subject-8","grades.csv"),
  delim = ":",
  na = "$"
)
```

## 2) Student population analysis

### Q5)

```{r}
ggplot(students, aes(x = factor(group))) +
  geom_bar() +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  )
```

### Q6)

```{r}
ggplot(students, aes(x = factor(group), fill = sex)) +
  geom_bar(position = "fill") +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Percentage of Students",
    fill = "Gender"
  )
```

### Q7)

```{r}
library(lubridate)
students_age <- students |>
  mutate(age = time_length(today() - birth_date, unit = "year"))

ggplot(students_age, aes(x = age)) +
  geom_histogram(binwidth = 1) +
  labs(
    title = "Distribution of Student Ages",
    x = "Age (years)",
    y = "Number of students"
  )
```

### Q8)

```{r}
median_age_by_group <- students_age |>
  group_by(group) |>
  summarise(median_age = median(age, na.rm = TRUE)) |>
  arrange(group)

kable(median_age_by_group, 
      col.names = c("Group", "Median Age"), 
      caption = "Median Age of Students by Group")
```

### Q9)

```{r}
oldest_per_group <- students_age |>
  group_by(group) |>
  slice_max(age, n = 1, with_ties = FALSE) |>
  ungroup() |>
  select(id, sex, age, group) |>
  arrange(desc(age))

kable(oldest_per_group, 
      col.names = c("ID", "Sex", "Age", "Group"), 
      caption = "Oldest Student in Each Group")
```

## 3) Simple grade analysis

### Q10)

The data set contains `r nrow(grades_clean |> filter(!is.na(grade)))` grades.

### Q11)

```{r}
vr_course_id <- courses |>
  filter(course == "Virtual Reality and Simulated Environments") |>
  pull(course_id)

vr_avg <- grades_clean |>
  filter(course_id == vr_course_id) |>
  inner_join(students, by = "id") |>
  group_by(group) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE)) 

ggplot(vr_avg, aes(x = group, y = avg_grade)) +
  geom_col() +
  labs(
    title = "Average grade in 'Virtual Reality and Simulated Environments' by group",
    x = "Group",
    y = "Average Grade"
  )
```

### Q12

```{r}
grades_with_module <- grades_clean |>
  inner_join(courses, by = "course_id") |>
  select(id, course_id, grade, module) |>
  filter(!is.na(grade))

ggplot(grades_with_module, aes(x = module, y = grade, fill = as.factor(module))) +
  geom_boxplot() +
  labs(
    title = "Comparison of grade distributions by module",
    x = "Module",
    y = "Grade"
  )
```

## 4) Attendance analysis

### Q13
```{r}
grades_per_student <- grades_clean |>
  group_by(id) |>
  summarise(nb_grades = n(), .groups = "drop") |>
  inner_join(students |> select(id, group, sex), by = "id")

grades_per_student |>
  slice_head(n = 5) |>
  kable()

summary_table <- grades_per_student |>
  summarise(
    min = min(nb_grades),
    max = max(nb_grades),
    mean = round(mean(nb_grades), 1),
    median = median(nb_grades)
  )
```

### Q14

```{r}
grades_per_student |>
  ggplot(aes(x = sex, y = nb_grades, fill = sex)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Number of Grades by Sex",
    x = "Sex",
    y = "Number of Grades"
  )
```

### Q15

```{r}
xeno_course_id <- courses |>
  filter(course == "Xenobiology and Extraterrestrial Life") |>
  pull(course_id)

xeno_grades_per_student <- grades_clean |>
  filter(course_id == xeno_course_id) |>
  group_by(id) |>
  summarise(nb_grades_xeno = n(), .groups = "drop") |>

  left_join(students |> select(id, group), by = "id") |>
  select(id, group, nb_grades_xeno)

xeno_grades_per_student |>
  slice_head(n = 10) |>
  kable()
```

### Q16

```{r}
xeno_distribution <- xeno_grades_per_student |>
  group_by(nb_grades_xeno) |>
  summarise(n_students = n(), .groups = "drop")

ggplot(xeno_distribution, aes(x = nb_grades_xeno, y = n_students)) +
  geom_col() +
  labs(
    x = "Number of grades in Xenobiology and Extraterrestrial Life",
    y = "Number of students",
    title = "Distribution of number of grades per student"
  )
```

### Q17

```{r}
ggplot(xeno_grades_per_student, aes(x = factor(nb_grades_xeno), fill = factor(group))) +
  geom_bar(position = "fill") + 
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    x = "Number of grades in Xenobiology and Extraterrestrial Life",
    y = "Percentage of students",
    fill = "Group",
    title = "Proportion of students per number of grades by group"
  )
```







